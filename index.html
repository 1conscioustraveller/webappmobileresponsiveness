<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TubeDJ Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        background: #0a2a66;
        color: #00e0ff;
        font-family: sans-serif;
        margin: 0;
        padding: 20px;
      }

      /* ðŸŽ› Deck Grid */
      .deck-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        justify-items: center;
        align-items: start;
      }

      .deck iframe {
        width: 100% !important;
        max-width: 360px;
        height: auto;
        aspect-ratio: 16 / 9;
      }

      .deck {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

      .fader {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 10px;
      }

      .fader label {
        margin-bottom: 8px;
        font-weight: bold;
      }

      /* Volume faders */
      .vertical-slider {
        transform: rotate(270deg);
        -webkit-appearance: none;
        appearance: none;
        width: 160px;
        height: 18px;
        background: linear-gradient(to right, #222, #000);
        border-radius: 8px;
        outline: none;
        box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.8);
        margin-bottom: 15px;
      }

      .vertical-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 28px;
        background: #222;
        border: 2px solid #00e0ff;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 0 6px #00e0ff, 0 0 12px rgba(0, 224, 255, 0.6);
      }

      .vertical-slider::-moz-range-thumb {
        width: 24px;
        height: 28px;
        background: #222;
        border: 2px solid #00e0ff;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 0 6px #00e0ff, 0 0 12px rgba(0, 224, 255, 0.6);
      }

      /* Speed (Pitch) faders */
      .pitch-slider {
        transform: rotate(270deg);
        -webkit-appearance: none;
        appearance: none;
        width: 160px;
        height: 18px;
        background: linear-gradient(to right, #111, #000);
        border-radius: 8px;
        outline: none;
        box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.8);
      }

      .pitch-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 28px;
        background: #222;
        border: 2px solid #ff4081;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 0 6px #ff4081, 0 0 12px rgba(255, 64, 129, 0.6);
      }

      .pitch-slider::-moz-range-thumb {
        width: 24px;
        height: 28px;
        background: #222;
        border: 2px solid #ff4081;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 0 6px #ff4081, 0 0 12px rgba(255, 64, 129, 0.6);
      }

      .speed-control {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 12px;
        color: #ff4081;
        margin-top: 10px;
      }

      .rate-label {
        margin-top: 6px;
        font-size: 14px;
        font-weight: bold;
        color: #ff4081;
      }

      /* Crossfader */
      .crossfader {
        margin-top: 40px;
        text-align: center;
      }

      .crossfader input[type="range"] {
        -webkit-appearance: none;
        width: 500px;
        height: 16px;
        background: linear-gradient(to right, #333, #111);
        border-radius: 8px;
        outline: none;
        box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.8);
      }

      .crossfader input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 36px;
        height: 48px;
        background: #222;
        border: 2px solid #00e0ff;
        border-radius: 6px;
        cursor: pointer;
        box-shadow: 0 0 8px #00e0ff, 0 0 14px rgba(0, 224, 255, 0.7);
      }

      .crossfader input[type="range"]::-moz-range-thumb {
        width: 36px;
        height: 48px;
        background: #222;
        border: 2px solid #00e0ff;
        border-radius: 6px;
        cursor: pointer;
        box-shadow: 0 0 8px #00e0ff, 0 0 14px rgba(0, 224, 255, 0.7);
      }

      .searchload {
        margin-top: 30px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        text-align: center;
      }

      input[type="text"] {
        width: 150px;
        padding: 5px;
      }

      button {
        margin-top: 5px;
        padding: 5px 10px;
        background: #00bcd4;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background: #00e0ff;
      }

      /* ðŸ“± Mobile tweaks */
      @media (max-width: 768px) {
        .crossfader input[type="range"] {
          width: 95%;
          height: 28px;
        }

        .crossfader input[type="range"]::-webkit-slider-thumb {
          width: 54px;
          height: 72px;
        }

        .crossfader input[type="range"]::-moz-range-thumb {
          width: 54px;
          height: 72px;
        }

        input[type="text"],
        button {
          width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      function TubeDJ() {
        const playersRef = React.useRef({});
        const [volumes, setVolumes] = React.useState({ A: 50, B: 50, C: 50, D: 50 });
        const [crossfade, setCrossfade] = React.useState(0.5);
        const [videoIds, setVideoIds] = React.useState({ A: "", B: "", C: "", D: "" });
        const [rates, setRates] = React.useState({ A: 1, B: 1, C: 1, D: 1 });
        const playbackRates = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2];

        React.useEffect(() => {
          const tag = document.createElement("script");
          tag.src = "https://www.youtube.com/iframe_api";
          document.body.appendChild(tag);

          window.onYouTubeIframeAPIReady = () => {
            ["A", "B", "C", "D"].forEach((id) => {
              playersRef.current[id] = new window.YT.Player(`player-${id}`, {
                height: "100%",
                width: "100%",
                videoId: "dQw4w9WgXcQ",
                playerVars: { controls: 1 },
              });
            });
          };
        }, []);

        const applyVolumes = (xfade, currentVolumes) => {
          const leftFactor = 1 - xfade;
          const rightFactor = xfade;

          ["A", "B"].forEach((deck) => {
            const player = playersRef.current[deck];
            if (player) {
              if (player.unMute) player.unMute();
              player.setVolume((currentVolumes[deck] / 100) * leftFactor * 100);
            }
          });

          ["C", "D"].forEach((deck) => {
            const player = playersRef.current[deck];
            if (player) {
              if (player.unMute) player.unMute();
              player.setVolume((currentVolumes[deck] / 100) * rightFactor * 100);
            }
          });
        };

        const handleVolume = (deck, value) => {
          const updated = { ...volumes, [deck]: value };
          setVolumes(updated);
          applyVolumes(crossfade, updated);
        };

        const handleCrossfade = (value) => {
          setCrossfade(value);
          applyVolumes(value, volumes);
        };

        const handleRateChange = (deck, value) => {
          const nearest = playbackRates.reduce((prev, curr) =>
            Math.abs(curr - value) < Math.abs(prev - value) ? curr : prev
          );
          setRates((prev) => ({ ...prev, [deck]: nearest }));
          const player = playersRef.current[deck];
          if (player?.setPlaybackRate) {
            player.setPlaybackRate(nearest);
          }
        };

        const extractVideoId = (urlOrId) => {
          try {
            const url = new URL(urlOrId);
            if (url.hostname.includes("youtube.com")) {
              return url.searchParams.get("v");
            }
            if (url.hostname.includes("youtu.be")) {
              return url.pathname.slice(1);
            }
          } catch {
            return urlOrId;
          }
          return urlOrId;
        };

        const loadVideo = (deck) => {
          const id = extractVideoId(videoIds[deck]);
          const player = playersRef.current[deck];
          if (player?.loadVideoById) {
            player.loadVideoById(id);
          }
        };

        return (
          <div>
            <div className="deck-grid">
              {["A", "B", "C", "D"].map((deck) => (
                <div className="deck" key={deck}>
                  <div id={`player-${deck}`}></div>
                  <div className="fader">
                    <label>{deck}</label>
                    <input
                      className="vertical-slider"
                      type="range"
                      min="0"
                      max="100"
                      value={volumes[deck]}
                      onChange={(e) => handleVolume(deck, Number(e.target.value))}
                    />
                  </div>
                  <div className="speed-control">
                    <label>Pitch</label>
                    <input
                      className="pitch-slider"
                      type="range"
                      min="0.25"
                      max="2"
                      step="0.01"
                      value={rates[deck]}
                      onChange={(e) => handleRateChange(deck, Number(e.target.value))}
                    />
                    <div className="rate-label">{rates[deck].toFixed(2)}x</div>
                  </div>
                </div>
              ))}
            </div>

            <div className="crossfader">
              <label>Crossfader (A/B â‡„ C/D)</label>
              <input
                type="range"
                min="0"
                max="1"
                step="0.01"
                value={crossfade}
                onChange={(e) => handleCrossfade(Number(e.target.value))}
              />
            </div>

            <div className="searchload">
              {["A", "B", "C", "D"].map((deck) => (
                <div key={deck}>
                  <label>Paste YT URL:</label>
                  <br />
                  <input
                    type="text"
                    placeholder={`YouTube URL/ID for ${deck}`}
                    value={videoIds[deck]}
                    onChange={(e) =>
                      setVideoIds((prev) => ({ ...prev, [deck]: e.target.value }))
                    }
                  />
                  <button onClick={() => loadVideo(deck)}>Load {deck}</button>
                </div>
              ))}
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<TubeDJ />);
    </script>
  </body>
</html>
